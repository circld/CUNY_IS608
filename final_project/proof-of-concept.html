<!DOCTYPE html>
<meta charset="utf-8">
<style>

    #map { width: 600px; height: 250px; }
    svg { position: relative; }
    path {
        fill-opacity: .2;
    }

</style>
<title>Denver Crime Map Proof-of-concept</title>
<head>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
</head>
<body>
<div id="map"></div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="heatmap.js"></script>
<script src="leaflet-heatmap.js"></script>

<script type="text/javascript">

    // define local data location
    var data_fpath = 'data/crime_sample.topojson';

    // heatmap.js
    var config = {
        "radius": 15,
        "maxOpacity": 0.65,
        "scaleRadius": false,
        "useLocalExtrema": true,
        latField: 'lat',
        lngField: 'lng',
        valueField: 'val'
    };

    // read in data
    d3.json(data_fpath, function(error, data) {

        if (error) return console.error(error);

        var heatmap_data = {
            max: 1,
            data: []
        };

        function get_coords(element, index, array) {
//            element.properties.FIRST_OCCURRENCE_DATE
             heatmap_data.data.push({
                lat: element.geometry.coordinates[1],
                lng: element.geometry.coordinates[0],
                val: 1
            });
        }

        var features = topojson.feature(data, data.objects.crime_sample).features;

        // set up leaflet map tile
        var base = new L.TileLayer(
                        "http://{s}.tiles.mapbox.com/v4/circld.b689c053/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiY2lyY2xkIiwiYSI6IjE5MjJCN2MifQ.Ztr1z4FvXHYHFQCxEubPpw"
        );

        // initialize heatmap overlay
        var heatmap = new HeatmapOverlay(config);

        var map = L.map('map', {
            center: new L.LatLng(39.737, -104.981),
            zoom: 12,
            maxZoom: 13,
            minZoom: 11,
            layers: [base, heatmap]
        });

        // populate heatmap_data arrays
        features.forEach(get_coords);

        // call function to take data.objects.crime_sample --> { lat: #, lon: #, value: intensity }
        var test = {max: 2, data: [{lat: 39.737, lng: -104.981, val: 2}]};
//        heatmap.setData(test);
        heatmap.setData(heatmap_data);

//        var map = L.map('map').setView([39.737, -104.981], 13)
//                .addLayer(new L.TileLayer(
//                        "http://{s}.tiles.mapbox.com/v4/circld.b689c053/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiY2lyY2xkIiwiYSI6IjE5MjJCN2MifQ.Ztr1z4FvXHYHFQCxEubPpw")
//                )
//                .addLayer(heatmapLayer);

    });

</script>
